function ajax_pieces(e,a,t){$.ajax(e,{success:function(e){var i=$(e).find(".piece-text-container").find("h2").html(),o=$(".template1"),l=o.clone();l.removeClass("template1"),l.removeClass("invisible"),l.find(".collapse").removeClass("in"),l.find(".accordion-toggle").attr("href","#"+ ++hash).text(a+" "+t),l.find(".panel-collapse").attr("id",hash).addClass("collapse").removeClass("in"),l.find(".panel-body").html(i),$("#accordion1").prepend(l.fadeIn())}})}function createPieceItem(e,a,t){var i=localStorage.getItem(e),o=$(".template1"),l=o.clone();l.removeClass("template1"),l.removeClass("invisible"),l.find(".collapse").removeClass("in"),l.find(".accordion-toggle").attr("href","#"+ ++hash).html(a),l.find(".panel-collapse").attr("id",hash).addClass("collapse").removeClass("in"),l.find(".panel-body").html(i+"<div class = 'popup-title'>"+t+"</div>"),$("#accordion1").prepend(l.fadeIn())}function createComixItem(e,a){var t="<img src = 'http://harvardlampoon.com"+e+"'/>",i=$(".template4"),o=i.clone();o.removeClass("template4"),o.removeClass("invisible"),o.find(".collapse").removeClass("in"),o.find(".accordion-toggle").attr("href","#"+ ++hash).text(a),o.find(".panel-collapse").attr("id",hash).addClass("collapse").removeClass("in"),o.find(".panel-body").html(t),$("#accordion4").prepend(o.fadeIn())}function createIssueItem(e,a,t,i){for(piece in i){var o="http://harvardlampoon.com"+i[piece];chrome.storage.sync.get(o,function l(e){for(item in e){var a=e[item],i=a.Title,o=a.Url,l=a.Author,r=localStorage.getItem(o),s=$(".template2"),n=s.clone();n.removeClass("template2"),n.removeClass("invisible"),n.find(".collapse").removeClass("in"),n.find(".accordion-toggle").attr("href","#"+ ++hash).html("<i>"+t+"</i>: "+i),n.find(".panel-collapse").attr("id",hash).addClass("collapse").removeClass("in"),n.find(".panel-body").html(r),$("#accordion2").prepend(n.fadeIn())}})}}function createAuthorItem(e,a){for(piece in e)to_search=e[piece],"http:"!=to_search.split("/")[0]&&(to_search="http://harvardlampoon.com"+to_search),chrome.storage.sync.get(to_search,function t(e){for(piece in e){var t=e[piece],i=t.Title,o=t.Url,l=localStorage.getItem(o),r=$(".template3"),s=r.clone();s.removeClass("template3"),s.removeClass("invisible"),s.find(".collapse").removeClass("in"),s.find(".accordion-toggle").attr("href","#"+ ++hash).html("<i>"+a+":</i> "+i),s.find(".panel-collapse").attr("id",hash).addClass("collapse").removeClass("in"),s.find(".panel-body").html(l),$("#accordion3").prepend(s.fadeIn())}})}var minusIcon='<img src = "img/circle-with-minus.svg" class = "minus icon inactive"/>',hash=1;$(document).ready(function(){chrome.storage.sync.get(function(e){if(chrome.runtime.error)alert("an error occurred");else for(item in e){var a=e[item];switch(a.Type){case"author":createAuthorItem(a.List,a.Author);break;case"issue":createComixItem(a.Img,a.Title),createIssueItem(a.Img,a.Description,a.Title,a.List);break;case"comix":createComixItem(a.Img,a.Title);break;case"piece":a.Img&&createComixItem(a.Img,a.Title),createPieceItem(a.Url,a.Title,a.Author)}}}),$("#jesture-page-link").each(function(){$(this).click(function(e){e.preventDefault();var a=$(this).attr("href"),t=!1;chrome.tabs.getAllInWindow(null,function(e){for(i in e)e[i].url.split("/")[3]==a&&(t=!0,chrome.tabs.update(e[i].id,{selected:!0}));t||chrome.tabs.create({url:a})})})})});