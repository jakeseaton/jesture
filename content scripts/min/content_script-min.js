function main_home(){main_piece()}function main_piece(){var e=[],t=[];chrome.storage.sync.get(function(e){if(chrome.runtime.error)alert("an error occurred");else{for(i in e)curr=e[i],"piece"==curr.Type&&t.push(curr.Title);$(".piece-text-container").each(function(){var e=$(".piece-title").html();-1!=$.inArray(e,t)?0==$(this).has("#jesture-container").length&&$(this).prepend(jesture_star_active):0==$(this).has("#jesture-container").length&&$(this).prepend(jesture_star_inactive)}),$(".star").click(function(){var e={};e.Type="piece";var i=$(".piece-header"),r,a=$(".piece-title").html(),n=i.find(".piece-author").find("a").html();if($(".piece").hasClass("no_art"))r=!1;else{var r=$(".piece-artwork").find("img").attr("src");console.log("this piece's image is",r)}if(e.Title=a,e.Author=n,e.Url=currentUrl,e.Img=r,$(this).hasClass("inactive")){console.log(e),t.push(e.Title);var s={};send_to_background(currentUrl),s[currentUrl]=e,chrome.storage.sync.set(s,function(){chrome.storage.sync.get(function(e){console.log(e)})}),change_to_active(this)}else index_to_remove=t.indexOf(e.Title),t.splice(index_to_remove,1),chrome.storage.sync.remove(e.Url),chrome.storage.sync.get(function c(e){console.log(e)}),change_to_inactive(this)})}})}function main_thumbnails(){var e=[],t=[];chrome.storage.sync.get(function i(r){if(chrome.runtime.error)alert("there was an error");else{for(item in r)"piece"==r[item].Type&&t.push(r[item].Title);$(".info-bar").each(function(){$(this).css({cursor:"auto"}),$(this).hover(function(){$(this).animate({height:"110px"}),$(this).find(".piece-link").toggle()},function(){$(this).animate({height:"90px"}),$(this).find(".piece-link").toggle()});var e=$(this).find(".piece-title").html();-1!=$.inArray(e,t)?0==$(this).has("#jesture-container").length&&$(this).append(jesture_star_active):0==$(this).has("#jesture-container").length&&$(this).append(jesture_star_inactive)}),$(".star").click(function(){var i={};i.Type="piece";var r=$(this).parent().parent().parent().parent(),a,n,s,c;if(c=$(r).hasClass("piece-art")?$(r).find(".background").find("img").attr("src"):!1,n=$(r).find("a").attr("href"),n="http://harvardlampoon.com"+n,console.log(n),a=$(r).find(".author-link").html(),s=$(r).find("h3").html(),i.Title=s,i.Author=a,i.Img=c,i.Url=n,send_to_background(n),$(this).hasClass("inactive")){var o={};o[n]=i,chrome.storage.sync.set(o),t.push(i.Title),change_to_active(this)}else{var h=e.indexOf(i);e.splice(h,1),chrome.storage.sync.remove(n),console.log("removed from storage"),h=t.indexOf(i.Title),t.splice(h,1),change_to_inactive(this)}})}})}function main_comix_home(){var e=[];chrome.storage.sync.get(function t(i){if(chrome.runtime.error)alert("there was an error");else{for(item in i)(i[item].Type="comix")&&e.push(i[item].Img);$(".comic-container").each(function(){var t=$(this).find("img").attr("src");-1!=$.inArray(t,e)?(console.log(t,"is in array",e),0==$(this).has("#jesture-container").length&&($(this).find("a").prepend(jesture_star_active),$(this).find("#jesture-container").css({position:"absolute",top:"0px",right:"0px"}))):0==$(this).has("#jesture-container").length&&(console.log(t,"is not in array",e),$(this).find("a").prepend(jesture_star_inactive),$(this).find("#jesture-container").css({position:"absolute",top:"0px",right:"0px"}))}),$(".star").click(function(t){t.preventDefault();var i={};i.Type="comix";var r=$(this).parentsUntil(".comic-outer-container"),a=$(r).find("img").not(".star").attr("src"),n=$(r).find("a").attr("href"),s=$(this).parent().parent().parent().parent().siblings().html();if(i.Title=s,i.Img=a,i.Url=n,$(this).hasClass("inactive")){var c={};c[n]=i,chrome.storage.sync.set(c),e.push(i.Img),change_to_active(this)}else chrome.storage.sync.remove(n),index_to_remove=e.indexOf(i.Img),e.splice(index_to_remove,1),change_to_inactive(this)})}})}function main_issue(){var e=[],t=[];chrome.storage.sync.get(function i(r){if(console.log(r),chrome.runtime.error)alert("there was an error");else{for(item in r)"piece"==r[item].Type?e.push(r[item].Title):"issue"==r[item].Type&&t.push(r[item].Title);$(".title-container").find("h2").each(function(){-1!=$.inArray($(this).html(),t)?(console.log($(this).html(),"is  in array",t),$(this).after(jesture_hat_active)):(console.log($(this).html(),"is not in array",t),$(this).after(jesture_hat_inactive))}),$(".hat").click(function(){var i={};i.Url=currentUrl,i.Title=$("body").find("h2").html(),console.log(i.Title),i.Type="issue";var r=[];if($("body").find(".piece").each(function(){curr_a=$(this).children().first().attr("href"),console.log(curr_a),send_to_background("http://harvardlampoon.com"+curr_a),r.push(curr_a)}),i.List=r,$(this).hasClass("inactive")){$.ajax("http://harvardlampoon.com/issues/",{async:!1,success:function n(e){$(e).find(".issue").find("a").each(function t(){"http://harvardlampoon.com"+$(this).attr("href")==currentUrl&&(i.Img=$(this).find("img").attr("src"),i.Description=$(this).siblings().find(".issue-description").html())})}}),$(".star").each(function(){if($(this).hasClass("inactive")){var t={};t.Type="piece";var i=$(this).parent().parent().parent().parent(),r,a,n,s;s=$(i).hasClass("piece-art")?$(i).find(".background").find("img").attr("src"):!1,a=$(i).find("a").attr("href"),a="http://harvardlampoon.com"+a,send_to_background(a),r=$(i).find(".author-link").html(),n=$(i).find("h3").html(),t.Title=n,t.Author=r,t.Img=s,t.Url=a;var c={};c[a]=t,chrome.storage.sync.set(c),change_to_active(this),e.push(t.Title)}});var a={};a[currentUrl]=i,chrome.storage.sync.set(a),change_to_active(this)}else chrome.storage.sync.remove(currentUrl),index_to_remove=t.indexOf(i.Title),t.splice(index_to_remove,1),change_to_inactive(this)})}})}function main_comix(){var e=[];chrome.storage.sync.get(function t(i){if(chrome.runtime.error)alert("there was an error");else{for(item in i)"comix"==i[item].Type&&e.push(i[item].Img);$("#comic-full").each(function(){var t=$(this).find("img").attr("src");-1!=$.inArray(t,e)?(console.log(t,"is in array",e),0==$(this).has("#jesture-container").length&&$(this).prepend(jesture_star_active)):0==$(this).has("#jesture-container").length&&$(this).prepend(jesture_star_inactive)}),$(".star").click(function(){var t={};t.Type="comix";var i=$(this).parent().parent().next().attr("src");if(t.Img=i,t.Url=currentUrl,$.ajax("http://harvardlampoon.com/comix/",{async:!1,success:function a(e){correct=$.grep($(e).find(".comic-outer-container"),function(e){return $(e).find("img").attr("src")==i}),Title=$(correct).find(".comic-title").html()}}),t.Title=Title,$(this).hasClass("inactive")){var r={};r[currentUrl]=t,e.push(t.Img),chrome.storage.sync.set(r),change_to_active(this)}else chrome.storage.sync.remove(currentUrl),index_to_remove=e.indexOf(t.Img),change_to_inactive(this)})}})}function main_issues(){var e=[];chrome.storage.sync.get(function t(i){if(chrome.runtime.error)alert("there was an error");else{for(item in i)"issue"==i[item].Type&&e.push(i[item].Title);$(".issue").each(function(){var t=$(this).find("h2").html();-1!=$.inArray(t,e)?(console.log(t,"is in array",e),0==$(this).has("#jesture-container").length&&$(this).find(".issue-description").after(jesture_star_active)):0==$(this).has("#jesture-container").length&&$(this).find(".issue-description").after(jesture_star_inactive)}),$(".star").click(function(t){t.preventDefault();var i={};i.Type="issue";var r=$(this).parent().parent().parent(),a=r.find("h2").html(),n=r.find("img").attr("src"),s=r.find("a").attr("href");console.log(s);var c=[];$.ajax(s,{async:!1,success:function l(e){$(e).find(".piece").each(function(){curr_a=$(this).children().first().attr("href"),send_to_background("http://harvardlampoon.com"+curr_a),c.push(curr_a)})}}),i.List=c;var o=r.find(".issue-description").html();if(i.Title=a,i.Img=n,i.Url="http://harvardlampoon.com"+s,i.Description=o,$(this).hasClass("inactive")){e.push(i.Title),$.ajax(i.Url,{async:!1,success:function u(e){$(e).find(".piece").each(function(){console.log("adding sub piece");var e={};e.Type="piece";var t=$(this),i,r,a,n;n=$(t).hasClass("piece-art")?$(t).find(".background").find("img").attr("src"):!1,r=$(t).find("a").attr("href"),r="http://harvardlampoon.com"+r,send_to_background(r),i=$(t).find(".author-link").html(),a=$(t).find("h3").html(),e.Title=a,e.Author=i,e.Img=n,e.Url=r;var s={};s[r]=e,chrome.storage.sync.set(s)})}});var h={};h[i.Url]=i,chrome.storage.sync.set(h),change_to_active(this)}else chrome.storage.sync.remove(i.Url),index_to_remove=e.indexOf(i.Title),change_to_inactive(this)})}})}function main_authors(){var e=[],t=[];chrome.storage.sync.get(function i(r){if(chrome.runtime.error)alert("there was an error");else{for(item in r)"author"==r[item].Type?e.push(r[item].Author):"piece"==r[item].Type&&t.push(r[item].Title);$(".author-header").each(function(){var t=$(this).find("h2").html();-1!=$.inArray(t,e)?0==$(this).has("#jesture-container").length&&$(this).append(jesture_hat_active):0==$(this).has("#jesture-container").length&&$(this).append(jesture_hat_inactive)}),$(".info-bar").each(function(){$(this).css({cursor:"auto"}),$(this).hover(function(){$(this).animate({height:"110px"}),$(this).find(".piece-link").toggle()},function(){$(this).animate({height:"90px"}),$(this).find(".piece-link").toggle()});var e=$(this).find(".piece-title").html();-1!=$.inArray(e,t)?0==$(this).has("#jesture-container").length&&$(this).append(jesture_star_active):0==$(this).has("#jesture-container").length&&$(this).append(jesture_star_inactive)}),$(".star").click(function(){var e={};e.Type="piece";var i=$(this).parent().parent().parent().parent(),r,a,n,s;if(s=$(i).hasClass("piece-art")?$(i).find(".background").find("img").attr("src"):!1,a=$(i).find("a").attr("href"),a="http://harvardlampoon.com"+a,console.log(a),r=$(i).find(".author-link").html(),n=$(i).find("h3").html(),e.Title=n,e.Author=r,e.Img=s,e.Url=a,send_to_background(a),$(this).hasClass("inactive")){var c={};c[a]=e,chrome.storage.sync.set(c),t.push(e.Title),change_to_active(this)}else chrome.storage.sync.set(a),index_to_remove=t.indexOf(e.Title),t.splice(index_to_remove,1),change_to_inactive(this)}),$(".hat").click(function(){var i={};i.Type="author";var r=$(this).parent().find("h2").html();i.Author=r;var a=[];if($("body").find(".piece").each(function(){curr_a=$(this).children().first().attr("href"),send_to_background("http://harvardlampoon.com"+curr_a),a.push(curr_a)}),i.List=a,i.Url=currentUrl,$(this).hasClass("inactive")){$(".star").each(function(){if($(this).hasClass("inactive")){var e={};e.Type="piece";var i=$(this).parent().parent().parent().parent(),r,a,n,s;s=$(i).hasClass("piece-art")?$(i).find(".background").find("img").attr("src"):!1,a=$(i).find("a").attr("href"),a="http://harvardlampoon.com"+a,send_to_background(a),r=$(i).find(".author-link").html(),n=$(i).find("h3").html(),e.Title=n,e.Author=r,e.Img=s,e.Url=a;var c={};c[a]=e,chrome.storage.sync.set(c),change_to_active(this),t.push(e.Title)}});var n={};n[currentUrl]=i,e.push(i.Author),chrome.storage.sync.set(n),change_to_active(this)}else chrome.storage.sync.remove(currentUrl),index_to_remove=e.indexOf(i.Author),e.splice(index_to_remove,1),change_to_inactive(this)})}})}function change_to_active(e){$(e).hasClass("hat")?($(e).removeClass("inactive"),$(e).attr("src",active_hat_url),$(e).addClass("active")):($(e).removeClass("inactive"),$(e).attr("src",active_star_url),$(e).addClass("active"))}function change_to_inactive(e){$(e).hasClass("hat")?($(e).removeClass("active"),$(e).attr("src",inactive_hat_url),$(e).addClass("inactive")):($(e).removeClass("active"),$(e).attr("src",inactive_star_url),$(e).addClass("inactive"))}function send_to_background(e){chrome.runtime.sendMessage({question:"addstorage",u:e},function(e){console.log(e.eval)})}var currentUrl,styles_url=chrome.extension.getURL("css/jesture.css");$("head").append("<link rel = 'stylesheet' href ="+styles_url+"></link>");var icon_url=chrome.extension.getURL("img/icon128.png"),new_icon="<link rel = 'icon' href ="+icon_url+"></link>";$("head").append(new_icon);var jesture_url=chrome.extension.getURL("jesture_page.html"),inactive_star_url=chrome.extension.getURL("img/star_active.png"),active_star_url=chrome.extension.getURL("img/star_inactive.png"),active_star="<img class = 'star active' src = "+active_star_url+" alt = 'star'/>",inactive_star="<img class = 'star inactive' src = "+inactive_star_url+" alt = 'star'/>",jesture_star_inactive="<div id = 'jesture-container'><div id = 'jesture'>"+inactive_star+"</div></div>",jesture_star_active="<div id = 'jesture-container'><div id = 'jesture'>"+active_star+"</div></div>",inactive_hat_url=chrome.extension.getURL("img/hat_inactive.png"),active_hat_url=chrome.extension.getURL("img/hat_active.png"),inactive_hat="<img width = 36px height = 36px class = 'hat inactive' src = "+inactive_hat_url+" alt = 'star'/>",active_hat="<img width = 36px height = 36px class = 'hat active' src = "+active_hat_url+" alt = 'star'/>",jesture_hat_inactive=inactive_hat,jesture_hat_active=active_hat;chrome.storage.onChanged.addListener(function(e,t){console.log("storage was changed")}),chrome.runtime.sendMessage({question:"what is the current url?"},function e(t){currentUrl=t.url;var i=t.url.split("/");if("harvardlampoon.com"==i[2])switch(i[3]){case"":main_home();break;case"issue":main_issue(),main_thumbnails();break;case"issues":main_issues();break;case"piece":main_piece();break;case"author":main_authors();break;case"comix":""!=i[4]?main_comix():main_comix_home();break;case"masthead":}else console.log("Not on Lampoon site. On: ",tab.url)});