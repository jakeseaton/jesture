function main_home(){main_piece()}function updateAllData(){ALL_DATA=[],Hash=0,chrome.storage.sync.get(function e(t){for(i in t)Hash++,ALL_DATA.push(t[i])})}function main_piece(){var e=[],t=[];for(i in ALL_DATA)for(j in ALL_DATA[i])curr=ALL_DATA[i][j],(curr.Type="piece")&&t.push(curr);var a=Hash.toString();console.log(a),chrome.storage.sync.get(a,function r(i){if(console.log(i),chrome.runtime.error)alert("there was an error");else{for(item in e)"piece"==e[item].Type;$(".piece-text-container").each(function(){var e=$(".piece-title").html();-1!=$.inArray(e,t)?0==$(this).has("#jesture-container").length&&$(this).prepend(jesture_star_active):0==$(this).has("#jesture-container").length&&$(this).prepend(jesture_star_inactive)}),$(".star").click(function(){var i={};i.Type="piece";var a=$(".piece-header"),r,s=$(".piece-title").html(),n=a.find(".piece-author").find("a").html();if($(".piece").hasClass("no_art"))r=!1;else{var r=$(".piece-artwork").find("img").attr("src");console.log("this piece's image is",r)}if(i.Title=s,i.Author=n,i.Url=currentUrl,i.Img=r,send_to_background(currentUrl),$(this).hasClass("inactive"))t.push(i.Title),e.push(i),chrome.storage.sync.set({feed:e}),change_to_active(this);else{var c=e.indexOf(i);e.splice(c,1),chrome.storage.sync.set({feed:e}),console.log("removed from storage"),c=t.indexOf(i.Title),t.splice(c,1),change_to_inactive(this)}})}})}function main_thumbnails(){var e=[],t=[];chrome.storage.sync.get("feed",function i(a){if(chrome.runtime.error)alert("there was an error");else{e=a.feed;for(item in e)"piece"==e[item].Type&&t.push(e[item].Title);$(".info-bar").each(function(){$(this).css({cursor:"auto"}),$(this).hover(function(){$(this).animate({height:"110px"}),$(this).find(".piece-link").toggle()},function(){$(this).animate({height:"90px"}),$(this).find(".piece-link").toggle()});var e=$(this).find(".piece-title").html();-1!=$.inArray(e,t)?0==$(this).has("#jesture-container").length&&$(this).append(jesture_star_active):0==$(this).has("#jesture-container").length&&$(this).append(jesture_star_inactive)}),$(".star").click(function(){var i={};i.Type="piece";var a=$(this).parent().parent().parent().parent(),r,s,n,c;if(c=$(a).hasClass("piece-art")?$(a).find(".background").find("img").attr("src"):!1,s=$(a).find("a").attr("href"),s="http://harvardlampoon.com"+s,console.log(s),r=$(a).find(".author-link").html(),n=$(a).find("h3").html(),i.Title=n,i.Author=r,i.Img=c,i.Url=s,send_to_background(s),$(this).hasClass("inactive"))e.push(i),chrome.storage.sync.set({feed:e}),t.push(i.Title),change_to_active(this);else{var o=e.indexOf(i);e.splice(o,1),chrome.storage.sync.set({feed:e}),console.log("removed from storage"),o=t.indexOf(i.Title),t.splice(o,1),change_to_inactive(this)}})}})}function main_comix_home(){var e=[],t=[];chrome.storage.sync.get("feed",function i(a){if(chrome.runtime.error)alert("there was an error");else{e=a.feed;for(item in e)(e[item].Type="comix")&&t.push(e[item].Img);$(".comic-container").each(function(){var e=$(this).find("img").attr("src");-1!=$.inArray(e,t)?(console.log(e,"is in array",t),0==$(this).has("#jesture-container").length&&($(this).find("a").prepend(jesture_star_active),$(this).find("#jesture-container").css({position:"absolute",top:"0px",right:"0px"}))):0==$(this).has("#jesture-container").length&&(console.log(e,"is not in array",t),$(this).find("a").prepend(jesture_star_inactive),$(this).find("#jesture-container").css({position:"absolute",top:"0px",right:"0px"}))}),$(".star").click(function(i){i.preventDefault();var a={};a.Type="comix";var r=$(this).parentsUntil(".comic-outer-container"),s=$(r).find("img").not(".star").attr("src"),n=$(r).find("a").attr("href"),c=$(this).parent().parent().parent().parent().siblings().html();if(a.Title=c,a.Img=s,a.Url=n,$(this).hasClass("inactive"))e.push(a),chrome.storage.sync.set({feed:e}),t.push(a.Img),change_to_active(this);else{var o=e.indexOf(a);e.splice(o,1),chrome.storage.sync.set({feed:e}),o=t.indexOf(a.Img),t.splice(o,1),change_to_inactive(this)}})}})}function main_issue(){var e=[],t=[],i=[];chrome.storage.sync.get("feed",function a(e){if(console.log(e),chrome.runtime.error)alert("there was an error");else{var a=e.feed;for(item in a)"piece"==a[item].Type?t.push(a[item].Title):"issue"==a[item].Type&&i.push(a[item].Title);$(".title-container").find("h2").each(function(){-1!=$.inArray($(this).html(),i)?(console.log($(this).html(),"is  in array",i),$(this).after(jesture_hat_active)):(console.log($(this).html(),"is not in array",i),$(this).after(jesture_hat_inactive))}),$(".hat").click(function(){console.log("feed",a);var e={};e.Url=currentUrl,e.Title=$("body").find("h2").html(),console.log(e.Title),e.Type="issue";var r=[];if($("body").find(".piece").each(function(){curr_a=$(this).children().first().attr("href"),console.log(curr_a),send_to_background("http://harvardlampoon.com"+curr_a),r.push(curr_a)}),e.List=r,a.push(e),$(this).hasClass("inactive"))$.ajax("http://harvardlampoon.com/issues/",{async:!1,success:function n(t){$(t).find(".issue").find("a").each(function i(){"http://harvardlampoon.com"+$(this).attr("href")==currentUrl&&(e.Img=$(this).find("img").attr("src"),e.Description=$(this).siblings().find(".issue-description").html())})}}),$(".star").each(function(){if($(this).hasClass("inactive")){var e={};e.Type="piece";var i=$(this).parent().parent().parent().parent(),r,s,n,c;c=$(i).hasClass("piece-art")?$(i).find(".background").find("img").attr("src"):!1,s=$(i).find("a").attr("href"),s="http://harvardlampoon.com"+s,send_to_background(s),r=$(i).find(".author-link").html(),n=$(i).find("h3").html(),e.Title=n,e.Author=r,e.Img=c,e.Url=s,a.push(e),change_to_active(this),t.push(e.Title)}}),chrome.storage.sync.set({feed:a}),change_to_active(this),console.log("feed",a);else{var s=a.indexOf(e);a.splice(s,1),chrome.storage.sync.set({feed:a}),console.log("removed from storage"),s=i.indexOf(e.Title),i.splice(s,1),change_to_inactive(this)}})}})}function main_comix(){var e={},t=[],i=[];chrome.storage.sync.get("feed",function a(e){if(chrome.runtime.error)alert("there was an error");else{i=e.feed;for(item in i)"comix"==i[item].Type&&t.push(i[item].Img);$("#comic-full").each(function(){var e=$(this).find("img").attr("src");-1!=$.inArray(e,t)?(console.log(e,"is in array",t),0==$(this).has("#jesture-container").length&&$(this).append(jesture_star_active)):0==$(this).has("#jesture-container").length&&$(this).append(jesture_star_inactive)}),$(".star").click(function(){var e={};e.Type="comix";var a=$(this).parent().parent().prev().attr("src"),r=!1;if(e.Img=a,e.Url=currentUrl,$.ajax("http://harvardlampoon.com/comix/",{async:!1,success:function n(e){correct=$.grep($(e).find(".comic-outer-container"),function(e){return $(e).find("img").attr("src")==a}),r=$(correct).find(".comic-title").html()}}),e.Title=r,console.log(e),$(this).hasClass("inactive"))i.push(e),t.push(e.Img),chrome.storage.sync.set({feed:i}),change_to_active(this);else{var s=i.indexOf(e);i.splice(s,1),chrome.storage.sync.set({feed:i}),s=t.indexOf(e.Img),change_to_inactive(this)}})}})}function main_issues(){var e=[],t=[];chrome.storage.sync.get("feed",function i(a){if(chrome.runtime.error)alert("there was an error");else{e=a.feed;for(item in e)"issue"==e[item].Type&&t.push(e[item].Title);$(".issue").each(function(){var e=$(this).find("h2").html();-1!=$.inArray(e,t)?(console.log(e,"is in array",t),0==$(this).has("#jesture-container").length&&$(this).find(".issue-description").after(jesture_star_active)):0==$(this).has("#jesture-container").length&&($(this).find(".issue-description").after(jesture_star_inactive),$(this).find(".arrow-link").slideUp())}),$(".star").click(function(i){i.preventDefault();var a={};a.Type="issue";var r=$(this).parent().parent().parent(),s=r.find("h2").html(),n=r.find("img").attr("src"),c=r.find("a").attr("href");console.log(c);var o=[];$.ajax(c,{async:!1,success:function u(e){$(e).find(".piece").each(function(){curr_a=$(this).children().first().attr("href"),console.log(curr_a),send_to_background("http://harvardlampoon.com"+curr_a),o.push(curr_a)})}}),a.List=o;var h=r.find(".issue-description").html();if(a.Title=s,a.Img=n,a.Url="http://harvardlampoon.com"+c,a.Description=h,$(this).hasClass("inactive"))e.push(a),t.push(a.Title),$.ajax(a.Url,{async:!1,success:function f(t){$(t).find(".piece").each(function(){var t={};t.Type="piece";var i=$(this),a,r,s,n;n=$(i).hasClass("piece-art")?$(i).find(".background").find("img").attr("src"):!1,r=$(i).find("a").attr("href"),r="http://harvardlampoon.com"+r,send_to_background(r),a=$(i).find(".author-link").html(),s=$(i).find("h3").html(),t.Title=s,t.Author=a,t.Img=n,t.Url=r,-1==$.inArray(t,e)&&e.push(t)})}}),chrome.storage.sync.set({feed:e}),change_to_active(this);else{var l=e.indexOf(a);e.splice(l,1),chrome.storage.sync.set({feed:e}),l=t.indexOf(a.Title),change_to_inactive(this)}})}})}function main_authors(){var e=[],t=[],i=[];chrome.storage.sync.get("feed",function a(r){if(chrome.runtime.error)alert("there was an error");else{e=r.feed;for(item in e)"author"==e[item].Type?t.push(e[item].Author):"piece"==e[item].Type&&i.push(e[item].Title);$(".author-header").each(function(){var e=$(this).find("h2").html();-1!=$.inArray(e,t)?(console.log(e,"is in array",t),0==$(this).has("#jesture-container").length&&$(this).append(jesture_hat_active)):0==$(this).has("#jesture-container").length&&$(this).append(jesture_hat_inactive)}),$(".info-bar").each(function(){$(this).css({cursor:"auto"}),$(this).hover(function(){$(this).animate({height:"110px"}),$(this).find(".piece-link").toggle()},function(){$(this).animate({height:"90px"}),$(this).find(".piece-link").toggle()});var e=$(this).find(".piece-title").html();-1!=$.inArray(e,i)?0==$(this).has("#jesture-container").length&&$(this).append(jesture_star_active):0==$(this).has("#jesture-container").length&&$(this).append(jesture_star_inactive)}),$(".star").click(function(){var t={};t.Type="piece";var a=$(this).parent().parent().parent().parent(),r,s,n,c;if(c=$(a).hasClass("piece-art")?$(a).find(".background").find("img").attr("src"):!1,s=$(a).find("a").attr("href"),s="http://harvardlampoon.com"+s,console.log(s),r=$(a).find(".author-link").html(),n=$(a).find("h3").html(),t.Title=n,t.Author=r,t.Img=c,t.Url=s,send_to_background(s),$(this).hasClass("inactive"))e.push(t),chrome.storage.sync.set({feed:e}),i.push(t.Title),change_to_active(this);else{var o=e.indexOf(t);e.splice(o,1),chrome.storage.sync.set({feed:e}),console.log("removed from storage"),o=i.indexOf(t.Title),i.splice(o,1),change_to_inactive(this)}}),$(".hat").click(function(){var a={};a.Type="author";var r=$(this).parent().find("h2").html();console.log(r),a.Author=r;var s=[];if($("body").find(".piece").each(function(){curr_a=$(this).children().first().attr("href"),console.log(curr_a),send_to_background("http://harvardlampoon.com"+curr_a),s.push(curr_a)}),console.log(s),a.List=s,$(this).hasClass("inactive"))console.log("derp"),e.push(a),$(".star").each(function(){if($(this).hasClass("inactive")){var t={};t.Type="piece";var a=$(this).parent().parent().parent().parent(),r,s,n,c;c=$(a).hasClass("piece-art")?$(a).find(".background").find("img").attr("src"):!1,s=$(a).find("a").attr("href"),s="http://harvardlampoon.com"+s,send_to_background(s),r=$(a).find(".author-link").html(),n=$(a).find("h3").html(),t.Title=n,t.Author=r,t.Img=c,t.Url=s,e.push(t),change_to_active(this),i.push(t.Title)}}),t.push(a.Author),chrome.storage.sync.set({feed:e}),change_to_active(this);else{var n=e.indexOf(a);e.splice(n,1),chrome.storage.sync.set({feed:e}),n=t.indexOf(a.Author),t.splice(n,1),change_to_inactive(this)}})}})}function change_to_active(e){$(e).hasClass("hat")?($(e).removeClass("inactive"),$(e).attr("src",active_hat_url),$(e).addClass("active")):($(e).removeClass("inactive"),$(e).attr("src",active_star_url),$(e).addClass("active"))}function change_to_inactive(e){$(e).hasClass("hat")?($(e).removeClass("active"),$(e).attr("src",inactive_hat_url),$(e).addClass("inactive")):($(e).removeClass("active"),$(e).attr("src",inactive_star_url),$(e).addClass("inactive"))}function send_to_background(e){chrome.runtime.sendMessage({question:"addstorage",u:e},function(e){console.log(e.eval)})}var currentUrl,styles_url=chrome.extension.getURL("css/jesture.css");$("head").append("<link rel = 'stylesheet' href ="+styles_url+"></link>");var icon_url=chrome.extension.getURL("img/icon128.png"),new_icon="<link rel = 'icon' href ="+icon_url+"></link>";$("head").append(new_icon);var jesture_url=chrome.extension.getURL("jesture_page.html"),inactive_star_url=chrome.extension.getURL("img/star_active.png"),active_star_url=chrome.extension.getURL("img/star_inactive.png"),active_star="<img class = 'star active' src = "+active_star_url+" alt = 'star'/>",inactive_star="<img class = 'star inactive' src = "+inactive_star_url+" alt = 'star'/>",jesture_star_inactive="<div id = 'jesture-container'><div id = 'jesture'>"+inactive_star+"</div></div>",jesture_star_active="<div id = 'jesture-container'><div id = 'jesture'>"+active_star+"</div></div>",inactive_hat_url=chrome.extension.getURL("img/hat_inactive.png"),active_hat_url=chrome.extension.getURL("img/hat_active.png"),inactive_hat="<img width = 36px height = 36px class = 'hat inactive' src = "+inactive_hat_url+" alt = 'star'/>",active_hat="<img width = 36px height = 36px class = 'hat active' src = "+active_hat_url+" alt = 'star'/>",jesture_hat_inactive=inactive_hat,jesture_hat_active=active_hat;chrome.storage.onChanged.addListener(function(e,t){console.log("storage was changed")}),Hash=0;var ALL_DATA=[];chrome.storage.sync.get(function e(t){console.log(t);for(i in t)Hash++,ALL_DATA.push(t[i]);console.log(Hash),console.log(ALL_DATA)}),chrome.runtime.sendMessage({question:"what is the current url?"},function t(e){currentUrl=e.url;var t=e.url.split("/");if("harvardlampoon.com"==t[2])switch(t[3]){case"":main_home();break;case"issue":main_issue(),main_thumbnails();break;case"issues":main_issues();break;case"piece":main_piece();break;case"author":main_authors();break;case"comix":""!=t[4]?main_comix():main_comix_home();break;case"masthead":}else console.log("Not on Lampoon site. On: ",tab.url)});